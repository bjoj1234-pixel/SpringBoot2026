<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="questBoard.mapper.QuestBoardMapper">
	<!-- 게시글 추가 -->
	<insert id="inserQuestBoard" parameterType="qDTO">
		INSERT INTO questBoard(writer,email,subject,password,ref,re_step,re_level,content)
		VALUES(#{writer},#{email},#{subject},#{password},
		(SELECT IFNULL(MAX(r.ref)+1,1) FROM questBoard q),
		1,1,#{content})
	</insert>
	
	<!-- 게시글 전체출력 -->
	<select id="getAllQuestBoard" resultType="qDTO">
		SELECT * FROM questBoard ORDER BY ref DESC, re_step ASC
	</select>
	
	<!-- 하나의 게시글을 return -->
	<select id="getOneBoard" parameterType="int" resultType="qDTO">
		SELECT * FROM questBoard WHERE num=#{num}
	</select>
	
	
	<!-- 댓글 작성 추가 -->
	<select id="rePlyInsert" parameterType="qDTO">
		INSET INTO questBoard(writer,email,subject,password,ref,re_step,re_level,content)
		VALUES(#{writer},#{email},#{subject},#{password},#{ref},
		#{re_step}+1,#{re_level}+1,#{content})
	</select>
	
	<!-- 댓글 작성시 댓글의 순서와 단계를 update -->
	<select id="reSqUpdate" parameterType="qDTO">
		UPDATE questBoard SET re_step = re_step + 1
		WHERE ref = #{ref} AND re_step > #{re_step}
	</select>
</mapper>









